@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@Scripts.Render("~/Scripts/Knockout-3.2.0.js")
@Scripts.Render("~/Scripts/guildUtils.js")
@{
    ViewBag.Title = "Guild Roster";
}


<script type="text/javascript">
    $.ajax({
        type: "GET",
        url: 'http://us.battle.net/api/wow/guild/Blackrock/Pokemon%20Masters?fields=members&jsonp=bindMembers',
        dataType: "JSONP"
    });

    function bindMembers(data) {
        var mappedMembers = $.map(data.members, function (member) {
            return {
                Name: member.character.name,
                Rank: member.rank,
                memberUrl: "/Static/ViewPlayer.html?name=" + member.character.name
            };
        }).sort(function (a, b) {
            return a.Rank - b.Rank;
        });
        ko.applyBindings({
            guildMembers: mappedMembers
        });
    }

    function loadModal() {
        $('#myModal').load(this.href).dialog('open');
    }
</script>

<table>
    <thead>
        <tr>
            <th>Character Name</th>
            <th>Rank</th>
        </tr>
    </thead>
    <tbody data-bind="foreach: guildMembers">
        <tr>
            <td><a id="aPlayer" onclick="loadModal()"
                   data-bind="attr: {href: memberUrl}, text: Name"></a></td>
            <td data-bind="text: getRankName(Rank)"></td>
        </tr>
    </tbody>
</table>

<div id="myModal" class="modal hide fade">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"> × </button>
        <h3 id="myModalLabel">Modal header</h3>
    </div>
    <div class="modal-body">
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>